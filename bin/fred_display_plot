#!/usr/bin/perl
use strict;
use warnings;
use Env;

my $FRED = $ENV{FRED_HOME};
die "Please set environmental variable FRED_HOME to location of FRED home directory\n" if not $FRED;

my $gnuplot = $ENV{FRED_GNUPLOT};
if (not $gnuplot or (not -x $gnuplot)) {
  print "fred_display_plot requires gnuplot\n";
  exit;
}

my $open = $ENV{FRED_DISPLAY_PNG};
if (not $open or (not -x $open)) {
  print "fred_display_plot requires an executable to display png files\n";
  exit;
}

my $results;
my $args = join " ", @ARGV;
if ($args =~ /@/) {
  $results = `$FRED/bin/fred_event_plot @ARGV`;
}
else {
  $results = `$FRED/bin/fred_plot @ARGV`;
}

if ($results =~ /bad status/) {
  $results =~ s/fred_plot/fred_display_plot/;
  print "$results";
}
else {
  system "$open $results";
}

