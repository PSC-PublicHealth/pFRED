#!/usr/bin/perl
use strict;
use warnings;

my %good_loc = ();
open FH, "test_pop.txt";
my $line = <FH>;
while ($line = <FH>) {
  chomp $line;
  my @a = split " ", $line;
  for my $i (5..10) {
    $good_loc{$a[$i]} = 1 if $a[$i] > -1;
  }
}
close FH;

my $locs = scalar keys %good_loc;
$locs++; # for Community

open FH, "alleg_loc.txt";
open OUT, ">test_loc.txt";

print OUT "Locations = $locs\n";
print OUT "0 Community X 0 0 -1\n";
my $dlon = 0;
$line = <FH>;
while ($line = <FH>) {
  chomp $line;
  my ($n,$lab,$type,$lat,$lon,$c) = split " ", $line;
  $dlon = $lon + 65.0 if ($lon and ($dlon == 0));
  $lon -= $dlon if $lon;
  print OUT "$n $lab $type $lat $lon $c\n" if exists $good_loc{$n};
}
close OUT;
close FH;

