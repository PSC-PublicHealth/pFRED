#!/usr/bin/perl
use strict;
use warnings;
use Env;

my $FRED = $ENV{FRED_HOME};
die "Please set environmental variable FRED_HOME to location of FRED home directory\n" if not $FRED;

my ($key, $p, $init, $final, $incr) = @ARGV;
die "usage: fred_sweep key param init_val final_val increment\n" if not $incr;

die "File params.$key not found\n" if not -e "params.$key";
die "$p is not a valid parameter\n" if not good_param($p);

for (my $v = $init; $v <= $final; $v += $incr) {
  my $newkey = "${key}_$p=$v";
  my $pfile = "params.$newkey";
  system "cp params.$key $pfile";
  system "$FRED/bin/ch $p $v $pfile >& /dev/null";
  my $cmd = "$FRED/bin/run_fred -p $pfile -k $newkey";
  # print "$cmd\n";
  system "$cmd";
}
exit;

sub good_param {
  my ($param) = @_;
  $param =~ s/\[/\\[/g;
  $param =~ s/\-/\\-/g;
  my $dval = `grep '$param =' params.def`;
  chomp $dval;
  my @a = split " ", $dval;
  $dval = pop @a;
  return $dval;
}


